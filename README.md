# demo2

Small Spring Boot demo application (demo2).

This README shows how to run the project, connect to the embedded H2 database, and access autogenerated API documentation (Swagger/OpenAPI).

## Quick start (Windows PowerShell)

From the project root:

- Run in dev mode (uses the included Maven wrapper):

```powershell
# start the application
.\mvnw.cmd spring-boot:run
```

- Build and run the packaged jar:

```powershell
# build
.\mvnw.cmd -DskipTests package
# run
java -jar target\demo2-0.0.1-SNAPSHOT.jar
```

The app starts on port 8080 by default.

## Configuration (application.properties)

Default settings (in `src/main/resources/application.properties`):

- H2 in-memory database:
  - `spring.datasource.url=jdbc:h2:mem:TESTDB;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE`
  - User: `sa` (no password)
- H2 console enabled at `/h2-console`
- SpringDoc OpenAPI (Swagger UI) is included via `springdoc-openapi-starter-webmvc-ui`.

Notes:
- The in-memory H2 database exists only while the application JVM runs. If you need to inspect the DB from an external tool (IntelliJ DB tool, DBeaver), either run H2 in TCP mode or switch to a file-based JDBC URL.
- To persist data between runs, change the JDBC URL in `application.properties` to a file-based URL, for example:
  `spring.datasource.url=jdbc:h2:file:./data/TESTDB;DB_CLOSE_ON_EXIT=FALSE`

## H2 Console (web UI)

1. Start the app.
2. Open: http://localhost:8080/h2-console
3. Fill the login form:
   - JDBC URL: `jdbc:h2:mem:TESTDB;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE`
   - User Name: `sa`
   - Password: (leave empty)
4. Click Connect.

If you switch to a file-based DB, update the JDBC URL accordingly.

## API documentation (Swagger / OpenAPI)

SpringDoc is included. Once the app is running access:

- Swagger UI: http://localhost:8080/swagger-ui.html  (or `/swagger-ui/index.html`)
- OpenAPI JSON: http://localhost:8080/v3/api-docs

If Spring Security is enabled and locking down endpoints (this project includes `spring-boot-starter-security`), you may need to authenticate to access Swagger UI or the API endpoints. For local testing you can temporarily set a default user in `application.properties`:

```properties
spring.security.user.name=admin
spring.security.user.password=admin
```

Or update your security configuration to allow `/swagger-ui/**` and `/v3/api-docs/**`.

## Available endpoints (high level)

- Staffs
  - GET  `/staffs` — list staff
  - POST `/staffs/create` — create staff
  - GET  `/staffs/search` — search staffs (query params: `keyword`, `page`, `size`)

- Parcels
  - GET  `/parcels` — list parcels
  - GET  `/parcels/{id}` — get parcel by id
  - POST `/moveParcel` — move a parcel
  - PUT  `/parcels/update` — update parcel

- Warehouses
  - GET  `/warehouses` — list warehouses
  - GET  `/warehouses/{id}` — get by id
  - POST `/warehouses/create` — create
  - PUT  `/warehouses/update` — update

- Shipments (placeholder)
  - Base path: `/shipments`

## Notes and troubleshooting

- "H2 console can't connect" — ensure the app is running and the JDBC URL in the console matches `application.properties` (including the database name `TESTDB`).
- If Swagger UI shows a blank page or redirects to login, check Security configuration.
- If you add new controllers, annotate them with OpenAPI annotations (`@Tag`, `@Operation`) to improve generated documentation.

## Development tips

- Use the Swagger UI to exercise endpoints and copy request/response examples.
- For JSON date format in responses, `StaffResponse.dateOfBirth` is annotated with `@JsonFormat(pattern = "yyyy/MM/dd")` to render dates like `1980/12/31`.

If you want, I can:
- Add a README section with example curl commands for common flows.
- Add a single-file script to seed demo data.
- Add instructions to run the app in Docker.


